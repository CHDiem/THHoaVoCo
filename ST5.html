<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Bài kiểm tra</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    #timer {
      font-size: 24px;
      font-weight: bold;
      color: red;
      margin-bottom: 20px;
    }
    #form-container {
      width: 100%;
      max-width: 800px;
      margin: auto;
    }
    iframe {
      width: 100%;
      height: 700px;
      border: none;
    }

    /* CSS nhấp nháy */
    .blink {
      animation: blinkAnim 0.5s step-start infinite;
    }

    @keyframes blinkAnim {
      50% { visibility: hidden; }
    }
  </style>
</head>
<body>
  <div id="timer">Thời gian còn lại: 15:00</div>
  <div id="form-container">
    <iframe id="formFrame"
      src="https://docs.google.com/forms/d/e/1FAIpQLScY0ZAERMsCYnVyRQ-GL1j6j8uws6UPqwskfuXtu0Yirfh6pQ/viewform?embedded=true">
      Loading…
    </iframe>
  </div>

  <script>
    var duration = 15 * 60; // 15 phút tính bằng giây
    var display = document.getElementById("timer");

    var timer = setInterval(function() {
      var minutes = Math.floor(duration / 60);
      var seconds = duration % 60;
      seconds = seconds < 10 ? "0" + seconds : seconds;
      display.textContent = "Thời gian còn lại: " + minutes + ":" + seconds;

      // Còn 3 phút thì nhấp nháy
      if (duration <= 3 * 60 && duration >= 0) {
        display.classList.add("blink");
      } else {
        display.classList.remove("blink");
      }

      // Hết giờ thì khóa form
      if (--duration < 0) {
        clearInterval(timer);
        document.getElementById("form-container").innerHTML =
          "<h3>⏰ Hết thời gian làm bài!</h3>";
      }
    }, 1000);

    // Cache-busting: tránh lưu giao diện cũ
    const frame = document.getElementById("formFrame");
    const baseUrl = frame.getAttribute("src").split("?")[0];
    frame.src = baseUrl + "?embedded=true&v=" + new Date().getTime();
  </script>
</body>
</html>
